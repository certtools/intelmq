<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Isn't it sad to see all public and private feeds available and not use them
properly because it's too much " monkey&quot; work? thanks to intelmq you can collect and process all of them automatically and without effort. &quot;><meta name=author content=Gethvi><link href=https://docs.intelmq.org/develop/dev/bot-development/ rel=canonical><link href=../adding-feeds/ rel=prev><link href=../extensions-packages/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.33"><title>Bot Development - IntelMQ</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#bot-development class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../.. style="color: black"> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=IntelMQ class="md-header__button md-logo" aria-label=IntelMQ data-md-component=logo> <img src=../../static/images/Logo_Intel_MQ.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IntelMQ </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Bot Development </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=white data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/certtools/intelmq title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> certtools/intelmq </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=IntelMQ class="md-nav__button md-logo" aria-label=IntelMQ data-md-component=logo> <img src=../../static/images/Logo_Intel_MQ.svg alt=logo> </a> IntelMQ </label> <div class=md-nav__source> <a href=https://github.com/certtools/intelmq title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> certtools/intelmq </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/intelmq-manager/ class=md-nav__link> <span class=md-ellipsis> Using IntelMQ Manager </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user/intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../user/event/ class=md-nav__link> <span class=md-ellipsis> Event </span> </a> </li> <li class=md-nav__item> <a href=../../user/bots/ class=md-nav__link> <span class=md-ellipsis> Bots </span> </a> </li> <li class=md-nav__item> <a href=../../user/feeds/ class=md-nav__link> <span class=md-ellipsis> Feeds </span> </a> </li> <li class=md-nav__item> <a href=../../user/abuse-contacts/ class=md-nav__link> <span class=md-ellipsis> Abuse Contacts </span> </a> </li> <li class=md-nav__item> <a href=../../user/manager/ class=md-nav__link> <span class=md-ellipsis> Manager </span> </a> </li> <li class=md-nav__item> <a href=../../user/api/ class=md-nav__link> <span class=md-ellipsis> API </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Administrator Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Administrator Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin/intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Installation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin/installation/linux-packages/ class=md-nav__link> <span class=md-ellipsis> Linux Package </span> </a> </li> <li class=md-nav__item> <a href=../../admin/installation/pypi/ class=md-nav__link> <span class=md-ellipsis> PyPI </span> </a> </li> <li class=md-nav__item> <a href=../../admin/installation/dockerhub/ class=md-nav__link> <span class=md-ellipsis> DockerHub </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../admin/upgrade/ class=md-nav__link> <span class=md-ellipsis> Upgrade </span> </a> </li> <li class=md-nav__item> <a href=../../admin/hardware-requirements/ class=md-nav__link> <span class=md-ellipsis> Hardware Requirements </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin/configuration/intelmq/ class=md-nav__link> <span class=md-ellipsis> IntelMQ </span> </a> </li> <li class=md-nav__item> <a href=../../admin/configuration/intelmq-api/ class=md-nav__link> <span class=md-ellipsis> IntelMQ API </span> </a> </li> <li class=md-nav__item> <a href=../../admin/configuration/intelmq-manager/ class=md-nav__link> <span class=md-ellipsis> IntelMQ Manager </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> Management </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin/management/intelmq/ class=md-nav__link> <span class=md-ellipsis> IntelMQ </span> </a> </li> <li class=md-nav__item> <a href=../../admin/management/intelmq-api/ class=md-nav__link> <span class=md-ellipsis> IntelMQ API </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> Database </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> Database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin/database/postgresql/ class=md-nav__link> <span class=md-ellipsis> PostgreSQL </span> </a> </li> <li class=md-nav__item> <a href=../../admin/database/elasticsearch/ class=md-nav__link> <span class=md-ellipsis> Elasticsearch </span> </a> </li> <li class=md-nav__item> <a href=../../admin/database/splunk/ class=md-nav__link> <span class=md-ellipsis> Splunk </span> </a> </li> <li class=md-nav__item> <a href=../../admin/database/sqlite/ class=md-nav__link> <span class=md-ellipsis> SQLite </span> </a> </li> <li class=md-nav__item> <a href=../../admin/database/mssql/ class=md-nav__link> <span class=md-ellipsis> MSSQL </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> Utilities </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> Utilities </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin/utilities/bash-completion/ class=md-nav__link> <span class=md-ellipsis> Bash Completion </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex=0> <span class=md-ellipsis> Integrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin/integrations/misp/ class=md-nav__link> <span class=md-ellipsis> MISP </span> </a> </li> <li class=md-nav__item> <a href=../../admin/integrations/n6/ class=md-nav__link> <span class=md-ellipsis> N6 </span> </a> </li> <li class=md-nav__item> <a href=../../admin/integrations/cifv3/ class=md-nav__link> <span class=md-ellipsis> CIFv3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../admin/beta-features/ class=md-nav__link> <span class=md-ellipsis> Beta Features </span> </a> </li> <li class=md-nav__item> <a href=../../admin/common-problems/ class=md-nav__link> <span class=md-ellipsis> Common Problems </span> </a> </li> <li class=md-nav__item> <a href=../../admin/faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../guidelines/ class=md-nav__link> <span class=md-ellipsis> Guidelines </span> </a> </li> <li class=md-nav__item> <a href=../structure/ class=md-nav__link> <span class=md-ellipsis> Structure </span> </a> </li> <li class=md-nav__item> <a href=../environment/ class=md-nav__link> <span class=md-ellipsis> Environment </span> </a> </li> <li class=md-nav__item> <a href=../data-format/ class=md-nav__link> <span class=md-ellipsis> Data Format </span> </a> </li> <li class=md-nav__item> <a href=../adding-feeds/ class=md-nav__link> <span class=md-ellipsis> Adding Feeds </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Bot Development </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Bot Development </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#steps class=md-nav__link> <span class=md-ellipsis> Steps </span> </a> </li> <li class=md-nav__item> <a href=#layout-rules class=md-nav__link> <span class=md-ellipsis> Layout Rules </span> </a> <nav class=md-nav aria-label="Layout Rules"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#directories-hierarchy-on-default-installation class=md-nav__link> <span class=md-ellipsis> Directories Hierarchy on Default Installation </span> </a> </li> <li class=md-nav__item> <a href=#directories-and-files-naming class=md-nav__link> <span class=md-ellipsis> Directories and Files naming </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#guide class=md-nav__link> <span class=md-ellipsis> Guide </span> </a> <nav class=md-nav aria-label=Guide> <ul class=md-nav__list> <li class=md-nav__item> <a href=#naming-your-bot-class class=md-nav__link> <span class=md-ellipsis> Naming your bot class </span> </a> </li> <li class=md-nav__item> <a href=#choosing-the-parent-class class=md-nav__link> <span class=md-ellipsis> Choosing the parent class </span> </a> </li> <li class=md-nav__item> <a href=#template class=md-nav__link> <span class=md-ellipsis> Template </span> </a> </li> <li class=md-nav__item> <a href=#mixins class=md-nav__link> <span class=md-ellipsis> Mixins </span> </a> </li> <li class=md-nav__item> <a href=#pipeline-interactions class=md-nav__link> <span class=md-ellipsis> Pipeline Interactions </span> </a> </li> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> <nav class=md-nav aria-label=Logging> <ul class=md-nav__list> <li class=md-nav__item> <a href=#log-messages-format class=md-nav__link> <span class=md-ellipsis> Log Messages Format </span> </a> </li> <li class=md-nav__item> <a href=#log-levels class=md-nav__link> <span class=md-ellipsis> Log Levels </span> </a> </li> <li class=md-nav__item> <a href=#what-to-log class=md-nav__link> <span class=md-ellipsis> What to Log </span> </a> </li> <li class=md-nav__item> <a href=#how-to-log class=md-nav__link> <span class=md-ellipsis> How to Log </span> </a> <nav class=md-nav aria-label="How to Log"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#string-formatting-in-logs class=md-nav__link> <span class=md-ellipsis> String formatting in Logs </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-handling class=md-nav__link> <span class=md-ellipsis> Error handling </span> </a> </li> <li class=md-nav__item> <a href=#initialization class=md-nav__link> <span class=md-ellipsis> Initialization </span> </a> </li> <li class=md-nav__item> <a href=#custom-configuration-checks class=md-nav__link> <span class=md-ellipsis> Custom configuration checks </span> </a> </li> <li class=md-nav__item> <a href=#running class=md-nav__link> <span class=md-ellipsis> Running </span> </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=#parsers class=md-nav__link> <span class=md-ellipsis> Parsers </span> </a> <nav class=md-nav aria-label=Parsers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parse_line class=md-nav__link> <span class=md-ellipsis> parse_line </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tests class=md-nav__link> <span class=md-ellipsis> Tests </span> </a> </li> <li class=md-nav__item> <a href=#cache class=md-nav__link> <span class=md-ellipsis> Cache </span> </a> </li> <li class=md-nav__item> <a href=#documentation class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing-pre-releases class=md-nav__link> <span class=md-ellipsis> Testing Pre-releases </span> </a> <nav class=md-nav aria-label="Testing Pre-releases"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../extensions-packages/ class=md-nav__link> <span class=md-ellipsis> Extensions Packages </span> </a> </li> <li class=md-nav__item> <a href=../testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../library/ class=md-nav__link> <span class=md-ellipsis> Use as Library </span> </a> </li> <li class=md-nav__item> <a href=../release/ class=md-nav__link> <span class=md-ellipsis> Release </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../../security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../community/ class=md-nav__link> <span class=md-ellipsis> Community </span> </a> </li> <li class=md-nav__item> <a href=../../help/ class=md-nav__link> <span class=md-ellipsis> Help </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#steps class=md-nav__link> <span class=md-ellipsis> Steps </span> </a> </li> <li class=md-nav__item> <a href=#layout-rules class=md-nav__link> <span class=md-ellipsis> Layout Rules </span> </a> <nav class=md-nav aria-label="Layout Rules"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#directories-hierarchy-on-default-installation class=md-nav__link> <span class=md-ellipsis> Directories Hierarchy on Default Installation </span> </a> </li> <li class=md-nav__item> <a href=#directories-and-files-naming class=md-nav__link> <span class=md-ellipsis> Directories and Files naming </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#guide class=md-nav__link> <span class=md-ellipsis> Guide </span> </a> <nav class=md-nav aria-label=Guide> <ul class=md-nav__list> <li class=md-nav__item> <a href=#naming-your-bot-class class=md-nav__link> <span class=md-ellipsis> Naming your bot class </span> </a> </li> <li class=md-nav__item> <a href=#choosing-the-parent-class class=md-nav__link> <span class=md-ellipsis> Choosing the parent class </span> </a> </li> <li class=md-nav__item> <a href=#template class=md-nav__link> <span class=md-ellipsis> Template </span> </a> </li> <li class=md-nav__item> <a href=#mixins class=md-nav__link> <span class=md-ellipsis> Mixins </span> </a> </li> <li class=md-nav__item> <a href=#pipeline-interactions class=md-nav__link> <span class=md-ellipsis> Pipeline Interactions </span> </a> </li> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> <nav class=md-nav aria-label=Logging> <ul class=md-nav__list> <li class=md-nav__item> <a href=#log-messages-format class=md-nav__link> <span class=md-ellipsis> Log Messages Format </span> </a> </li> <li class=md-nav__item> <a href=#log-levels class=md-nav__link> <span class=md-ellipsis> Log Levels </span> </a> </li> <li class=md-nav__item> <a href=#what-to-log class=md-nav__link> <span class=md-ellipsis> What to Log </span> </a> </li> <li class=md-nav__item> <a href=#how-to-log class=md-nav__link> <span class=md-ellipsis> How to Log </span> </a> <nav class=md-nav aria-label="How to Log"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#string-formatting-in-logs class=md-nav__link> <span class=md-ellipsis> String formatting in Logs </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-handling class=md-nav__link> <span class=md-ellipsis> Error handling </span> </a> </li> <li class=md-nav__item> <a href=#initialization class=md-nav__link> <span class=md-ellipsis> Initialization </span> </a> </li> <li class=md-nav__item> <a href=#custom-configuration-checks class=md-nav__link> <span class=md-ellipsis> Custom configuration checks </span> </a> </li> <li class=md-nav__item> <a href=#running class=md-nav__link> <span class=md-ellipsis> Running </span> </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=#parsers class=md-nav__link> <span class=md-ellipsis> Parsers </span> </a> <nav class=md-nav aria-label=Parsers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parse_line class=md-nav__link> <span class=md-ellipsis> parse_line </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tests class=md-nav__link> <span class=md-ellipsis> Tests </span> </a> </li> <li class=md-nav__item> <a href=#cache class=md-nav__link> <span class=md-ellipsis> Cache </span> </a> </li> <li class=md-nav__item> <a href=#documentation class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing-pre-releases class=md-nav__link> <span class=md-ellipsis> Testing Pre-releases </span> </a> <nav class=md-nav aria-label="Testing Pre-releases"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <!-- comment
   SPDX-FileCopyrightText: 2015-2023 Sebastian Wagner, Filip Pokorný
   SPDX-License-Identifier: AGPL-3.0-or-later
--> <h1 id=bot-development>Bot Development</h1> <p>Here you should find everything you need to develop a new bot.</p> <h2 id=steps>Steps</h2> <ol> <li>Create appropriately placed and named python file.</li> <li>Use correct parent class.</li> <li>Code the functionality you want (with mixins, inheritance, etc).</li> <li>Create appropriately placed test file.</li> <li>Prepare code for testing your bot.</li> <li>Add documentation for your bot.</li> <li>Add changelog and news info.</li> </ol> <h2 id=layout-rules>Layout Rules</h2> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>intelmq/
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>  lib/
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    bot.py
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    cache.py
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    message.py
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    pipeline.py
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    utils.py
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>  bots/
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    collector/
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>      &lt;bot name&gt;/
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>            collector.py
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    parser/
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>      &lt;bot name&gt;/
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>            parser.py
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>    expert/
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>      &lt;bot name&gt;/
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>            expert.py
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>    output/
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>      &lt;bot name&gt;/
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>            output.py
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>  etc/
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>    runtime.yaml
</code></pre></div> <p>Assuming you want to create a bot for a new 'Abuse.ch' feed. It turns out that here it is necessary to create different parsers for the respective kind of events (e.g. malicious URLs). Therefore, the usual hierarchy <code>intelmq/bots/parser/&lt;FEED&gt;/parser.py</code> would not be suitable because it is necessary to have more parsers for each Abuse.ch Feed. The solution is to use the same hierarchy with an additional "description" in the file name, separated by underscore. Also see the section <em>Directories and Files naming</em>.</p> <p>Example (including the current ones):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>/intelmq/bots/parser/abusech/parser_domain.py
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>/intelmq/bots/parser/abusech/parser_ip.py
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>/intelmq/bots/parser/abusech/parser_ransomware.py
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>/intelmq/bots/parser/abusech/parser_malicious_url.py
</code></pre></div> <h4 id=directories-hierarchy-on-default-installation>Directories Hierarchy on Default Installation</h4> <ul> <li>Configuration Files Path: <code>/opt/intelmq/etc/</code></li> <li>PID Files Path: <code>/opt/intelmq/var/run/</code></li> <li>Logs Files and dumps Path: <code>/opt/intelmq/var/log/</code></li> <li>Additional Bot Files Path, e.g. templates or databases: <code>/opt/intelmq/var/lib/bots/[bot-name]/</code></li> </ul> <h4 id=directories-and-files-naming>Directories and Files naming</h4> <p>Any directory and file of IntelMQ has to follow the Directories and Files naming. Any file name or folder name has to:</p> <ul> <li>be represented with lowercase and in case of the name has multiple words, the spaces between them must be removed or replaced by underscores</li> <li>be self-explaining what the content contains.</li> </ul> <p>In the bot directories name, the name must correspond to the feed provider. If necessary and applicable the feed name can and should be used as postfix for the filename.</p> <p>Examples:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>intelmq/bots/parser/taichung/parser.py
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>intelmq/bots/parser/cymru/parser_full_bogons.py
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>intelmq/bots/parser/abusech/parser_ransomware.py
</code></pre></div> <h2 id=guide>Guide</h2> <h3 id=naming-your-bot-class>Naming your bot class</h3> <p>Class name of the bot (ex: PhishTank Parser) must correspond to the type of the bot (ex: Parser) e.g. <code>PhishTankParserBot</code></p> <h3 id=choosing-the-parent-class>Choosing the parent class</h3> <p>Please use the correct bot type as parent class for your bot. The <code>intelmq.lib.bot</code> module contains the following classes:</p> <ul> <li><code>CollectorBot</code></li> <li><code>ParserBot</code></li> <li><code>ExpertBot</code></li> <li><code>OutputBot</code></li> </ul> <h3 id=template>Template</h3> <p>Please adjust the doc strings accordingly and remove the in-line comments (<code>#</code>).</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=sd>SPDX-FileCopyrightText: 2021 Your Name</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=sd>SPDX-License-Identifier: AGPL-3.0-or-later</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=sd>Parse data from example.com, be a nice ExampleParserBot.</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=sd>Document possible necessary configurations.</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=kn>import</span> <span class=nn>sys</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=c1># imports for additional libraries and intelmq</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=kn>from</span> <span class=nn>intelmq.lib.bot</span> <span class=kn>import</span> <span class=n>ParserBot</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=k>class</span> <span class=nc>ExampleParserBot</span><span class=p>(</span><span class=n>ParserBot</span><span class=p>):</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>    <span class=n>option1</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;defaultvalue&quot;</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>    <span class=n>option2</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>        <span class=n>report</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>receive_message</span><span class=p>()</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>        <span class=n>event</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>new_event</span><span class=p>(</span><span class=n>report</span><span class=p>)</span>  <span class=c1># copies feed.name, time.observation</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>        <span class=o>...</span>  <span class=c1># implement the logic here</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>        <span class=n>event</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s1>&#39;source.ip&#39;</span><span class=p>,</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>)</span>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>        <span class=n>event</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s1>&#39;extra&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;os.name&quot;</span><span class=p>:</span> <span class=s2>&quot;Linux&quot;</span><span class=p>})</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>option2</span><span class=p>:</span>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>            <span class=n>event</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s1>&#39;extra&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;customvalue&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>option1</span><span class=p>})</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>        <span class=bp>self</span><span class=o>.</span><span class=n>send_message</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>        <span class=bp>self</span><span class=o>.</span><span class=n>acknowledge_message</span><span class=p>()</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=n>BOT</span> <span class=o>=</span> <span class=n>ExampleParserBot</span>
</code></pre></div> <p>Any attributes of the bot that are not private can be set by the user using the IntelMQ configuration settings.</p> <p>There are some names with special meaning. These can be used i.e. called:</p> <ul> <li><code>stop</code>: Shuts the bot down.</li> <li><code>receive_message</code></li> <li><code>send_message</code></li> <li><code>acknowledge_message</code>: see next section</li> <li><code>start</code>: internal method to run the bot</li> </ul> <p>These can be defined:</p> <ul> <li><code>init</code>: called at startup, use it to set up the bot (initializing classes, loading files etc)</li> <li><code>process</code>: processes the messages</li> <li><code>shutdown</code>: To Gracefully stop the bot, e.g. terminate connections</li> </ul> <p>All other names can be used freely.</p> <h3 id=mixins>Mixins</h3> <p>For common settings and methods you can use mixins from <code>intelmq.lib.mixins</code>. To use the mixins, just let your bot inherit from the Mixin class (in addition to the inheritance from the Bot class). For example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>class</span> <span class=nc>HTTPCollectorBot</span><span class=p>(</span><span class=n>CollectorBot</span><span class=p>,</span> <span class=n>HttpMixin</span><span class=p>):</span>
</code></pre></div> <p>The following mixins are available:</p> <ul> <li><code>HttpMixin</code></li> <li><code>SqlMixin</code></li> <li><code>CacheMixin</code></li> </ul> <p>The <code>HttpMixin</code> provides the HTTP attributes described in <code>common-parameters</code> and the following methods:</p> <ul> <li><code>http_get</code> takes an URL as argument. Any other arguments get passed to the <code>request.Session.get</code> method. <code>http_get</code> returns a <code>requests.Response</code>.</li> <li><code>http_session</code> can be used if you ever want to work with the session object directly. It takes no arguments and returns the bots request.Session.</li> </ul> <p>The <code>SqlMixin</code> provides methods to connect to SQL servers. Inherit this Mixin so that it handles DB connection for you. You do not have to bother:</p> <ul> <li>connecting database in the <code>self.init()</code> method, self.cur will be set in the <code>__init__()</code></li> <li>catching exceptions, just call <code>self.execute()</code> instead of <code>self.cur.execute()</code></li> <li><code>self.format_char</code> will be set to '%s' in PostgreSQL and to '?' in SQLite</li> </ul> <p>The <code>CacheMixin</code> provides methods to cache values for bots in a Redis database. It uses the following attributes:</p> <ul> <li><code>redis_cache_host: str = "127.0.0.1"</code></li> <li><code>redis_cache_port: int = 6379</code></li> <li><code>redis_cache_db: int = 9</code></li> <li><code>redis_cache_ttl: int = 15</code></li> <li><code>redis_cache_password: Optional[str] = None</code></li> </ul> <p>and provides the methods:</p> <ul> <li><code>cache_exists</code></li> <li><code>cache_get</code></li> <li><code>cache_set</code></li> <li><code>cache_flush</code></li> <li><code>cache_get_redis_instance</code></li> </ul> <h3 id=pipeline-interactions>Pipeline Interactions</h3> <p>We can call three methods related to the pipeline:</p> <ul> <li><code>self.receive_message()</code>: The pipeline handler pops one message from the internal queue if possible. Otherwise one message from the sources list is popped, and added it to an internal queue. In case of errors in process handling, the message can still be found in the internal queue and is not lost. The bot class unravels the message a creates an instance of the Event or Report class.</li> <li><code>self.send_message(event, path="_default")</code>: Processed message is sent to destination queues. It is possible to change the destination queues by optional <code>path</code> parameter.</li> <li><code>self.acknowledge_message()</code>: Message formerly received by <code>receive_message</code> is removed from the internal queue. This should always be done after processing and after the sending of the new message. In case of errors, this function is not called and the message will stay in the internal queue waiting to be processed again.</li> </ul> <h3 id=logging>Logging</h3> <h5 id=log-messages-format>Log Messages Format</h5> <p>Log messages have to be clear and well formatted. The format is the following:</p> <p>Format:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>&lt;timestamp&gt; - &lt;bot id&gt; - &lt;log level&gt; - &lt;log message&gt;
</code></pre></div> <p>Rules:</p> <ul> <li>the Log message MUST follow the common rules of a sentence, beginning with uppercase and ending with period.</li> <li>the sentence MUST describe the problem or has useful information to give to an inexperienced user a context. Pure stack traces without any further explanation are not helpful.</li> </ul> <p>When the logger instance is created, the bot id must be given as parameter anyway. The function call defines the log level, see below.</p> <h5 id=log-levels>Log Levels</h5> <ul> <li><em>debug</em>: Debugging information includes retrieved and sent messages, detailed status information. Can include sensitive information like passwords and amount can be huge.</li> <li><em>info</em>: Logs include loaded databases, fetched reports or waiting messages.</li> <li><em>warning</em>: Unexpected, but handled behavior.</li> <li><em>error</em>: Errors and Exceptions.</li> <li><em>critical</em> Program is failing.</li> </ul> <h5 id=what-to-log>What to Log</h5> <ul> <li>Try to keep a balance between obscuring the source code file with hundreds of log messages and having too little log messages.</li> <li>In general, a bot MUST report error conditions.</li> </ul> <h5 id=how-to-log>How to Log</h5> <p>The Bot class creates a logger with that should be used by bots. Other components won't log anyway currently. Examples:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Bot start processing.&#39;</span><span class=p>)</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s1>&#39;Pipeline failed.&#39;</span><span class=p>)</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>exception</span><span class=p>(</span><span class=s1>&#39;Pipeline failed.&#39;</span><span class=p>)</span>
</code></pre></div> <p>The <code>exception</code> method automatically appends an exception traceback. The logger instance writes by default to the file <code>/opt/intelmq/var/log/[bot-id].log</code> and to stderr.</p> <h6 id=string-formatting-in-logs>String formatting in Logs</h6> <p>Parameters for string formatting are better passed as argument to the log function, see <a href=https://docs.python.org/3/library/logging.html#logging.Logger.debug>https://docs.python.org/3/library/logging.html#logging.Logger.debug</a> In case of formatting problems, the error messages will be better. For example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Connecting to </span><span class=si>%r</span><span class=s1>.&#39;</span><span class=p>,</span> <span class=n>host</span><span class=p>)</span>
</code></pre></div> <h3 id=error-handling>Error handling</h3> <p>The bot class itself has error handling implemented. The bot itself is allowed to throw exceptions and <strong>intended to fail</strong>! The bot should fail in case of malicious messages, and in case of unavailable but necessary resources. The bot class handles the exception and will restart until the maximum number of tries is reached and fail then. Additionally, the message in question is dumped to the file <code>/opt/intelmq/var/log/[bot-id].dump</code> and removed from the queue.</p> <h3 id=initialization>Initialization</h3> <p>Maybe it is necessary so setup a Cache instance or load a file into memory. Use the <code>init</code> function for this purpose:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>class</span> <span class=nc>ExampleParserBot</span><span class=p>(</span><span class=n>Bot</span><span class=p>):</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>    <span class=k>def</span> <span class=nf>init</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>            <span class=bp>self</span><span class=o>.</span><span class=n>database</span> <span class=o>=</span> <span class=n>pyasn</span><span class=o>.</span><span class=n>pyasn</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>database</span><span class=p>)</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>        <span class=k>except</span> <span class=ne>IOError</span><span class=p>:</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;pyasn data file does not exist or could not be &quot;</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>                              <span class=s2>&quot;accessed in &#39;</span><span class=si>%s</span><span class=s2>&#39;.&quot;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>database</span><span class=p>)</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Read &#39;bots/experts/asn_lookup/README.md&#39; and &quot;</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>                              <span class=s2>&quot;follow the procedure.&quot;</span><span class=p>)</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>            <span class=bp>self</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</code></pre></div> <h3 id=custom-configuration-checks>Custom configuration checks</h3> <p>Every bot can define a static method <code>check(parameters)</code> which will be called by <code>intelmqctl check</code>. For example the check function of the ASNLookupExpert:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nd>@staticmethod</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>def</span> <span class=nf>check</span><span class=p>(</span><span class=n>parameters</span><span class=p>):</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>parameters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;database&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)):</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>        <span class=k>return</span> <span class=p>[[</span><span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=s2>&quot;File given as parameter &#39;database&#39; does not exist.&quot;</span><span class=p>]]</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>        <span class=n>pyasn</span><span class=o>.</span><span class=n>pyasn</span><span class=p>(</span><span class=n>parameters</span><span class=p>[</span><span class=s1>&#39;database&#39;</span><span class=p>])</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>        <span class=k>return</span> <span class=p>[[</span><span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=s2>&quot;Error reading database: </span><span class=si>%r</span><span class=s2>.&quot;</span> <span class=o>%</span> <span class=n>exc</span><span class=p>]]</span>
</code></pre></div> <h3 id=running>Running</h3> <p>You can always start any bot directly from command line by calling the executable. The executable will be created during installation a directory for binaries. After adding new bots to the code, install IntelMQ to get the files created. Don't forget to give an bot id as first argument. Also, running bots with other users than <code>intelmq</code> will raise permission errors.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>$<span class=w> </span>sudo<span class=w> </span>-i<span class=w> </span>intelmq
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>$<span class=w> </span>intelmqctl<span class=w> </span>run<span class=w> </span>file-output<span class=w>  </span><span class=c1># if configured</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>$<span class=w> </span>intelmq.bots.outputs.file.output<span class=w> </span>file-output
</code></pre></div> <p>You will get all logging outputs directly on stderr as well as in the log file.</p> <h3 id=examples>Examples</h3> <ul> <li>Check <a href=https://github.com/certtools/intelmq/tree/develop/intelmq/bots/experts>Expert Bots</a></li> <li>Check <a href=https://github.com/certtools/intelmq/tree/develop/intelmq/bots/parsers>Parser Bots</a></li> </ul> <h3 id=parsers>Parsers</h3> <p>Parsers can use a different, specialized Bot-class. It allows to work on individual elements of a report, splitting the functionality of the parser into multiple functions:</p> <ul> <li><code>process</code>: getting and sending data, handling of failures etc.</li> <li><code>parse</code>: Parses the report and splits it into single elements (e.g. lines). Can be overridden.</li> <li><code>parse_line</code>: Parses elements, returns an Event. Can be overridden.</li> <li><code>recover_line</code>: In case of failures and for the field <code>raw</code>, this function recovers a fully functional report containing only one element. Can be overridden.</li> </ul> <p>For common cases, like CSV, existing function can be used, reducing the amount of code to implement. In the best case, only <code>parse_line</code> needs to be coded, as only this part interprets the data.</p> <p>You can have a look at the implementation <code>intelmq/lib/bot.py</code> or at examples, e.g. the DummyBot in <code>intelmq/tests/lib/test_parser_bot.py</code>. This is a stub for creating a new Parser, showing the parameters and possible code:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>class</span> <span class=nc>MyParserBot</span><span class=p>(</span><span class=n>ParserBot</span><span class=p>):</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>report</span><span class=p>):</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;A generator yielding the single elements of the data.</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=sd>        Comments, headers etc. can be processed here. Data needed by</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=sd>        `self.parse_line` can be saved in `self.tempdata` (list).</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=sd>        Default parser yields stripped lines.</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=sd>        Override for your use or use an existing parser, e.g.:</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=sd>            parse = ParserBot.parse_csv</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>utils</span><span class=o>.</span><span class=n>base64_decode</span><span class=p>(</span><span class=n>report</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;raw&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>splitlines</span><span class=p>():</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>            <span class=k>yield</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>    <span class=k>def</span> <span class=nf>parse_line</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>line</span><span class=p>,</span> <span class=n>report</span><span class=p>):</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;A generator which can yield one or more messages contained in line.</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=sd>        Report has the full message, thus you can access some metadata.</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=sd>        Override for your use.</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>        <span class=k>raise</span> <span class=ne>NotImplementedError</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>        <span class=bp>self</span><span class=o>.</span><span class=n>tempdata</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># temporary data for parse, parse_line and recover_line</span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>        <span class=bp>self</span><span class=o>.</span><span class=n>__failed</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>        <span class=n>report</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>receive_message</span><span class=p>()</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>report</span><span class=p>):</span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>line</span><span class=p>:</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>                <span class=k>continue</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>                <span class=c1># filter out None</span>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a>                <span class=n>events</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span><span class=nb>bool</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse_line</span><span class=p>(</span><span class=n>line</span><span class=p>,</span> <span class=n>report</span><span class=p>)))</span>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>exception</span><span class=p>(</span><span class=s1>&#39;Failed to parse line.&#39;</span><span class=p>)</span>
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a>                <span class=bp>self</span><span class=o>.</span><span class=n>__failed</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>exc</span><span class=p>,</span> <span class=n>line</span><span class=p>))</span>
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a>                <span class=bp>self</span><span class=o>.</span><span class=n>send_message</span><span class=p>(</span><span class=o>*</span><span class=n>events</span><span class=p>)</span>
<a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a>
<a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a>        <span class=k>for</span> <span class=n>exc</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>__failed</span><span class=p>:</span>
<a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_dump_message</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>recover_line</span><span class=p>(</span><span class=n>line</span><span class=p>))</span>
<a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a>
<a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a>        <span class=bp>self</span><span class=o>.</span><span class=n>acknowledge_message</span><span class=p>()</span>
<a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a>
<a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a>    <span class=k>def</span> <span class=nf>recover_line</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>line</span><span class=p>):</span>
<a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Reverse of parse for single lines.</span>
<a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a>
<a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a><span class=sd>        Recovers a fully functional report with only the problematic line.</span>
<a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a>        <span class=k>return</span> <span class=s1>&#39;n&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>tempdata</span> <span class=o>+</span> <span class=p>[</span><span class=n>line</span><span class=p>])</span>
<a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a>
<a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a>
<a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a><span class=n>BOT</span> <span class=o>=</span> <span class=n>MyParserBot</span>
</code></pre></div> <h5 id=parse_line>parse_line</h5> <p>One line can lead to multiple events, thus <code>parse_line</code> can't just return one Event. Thus, this function is a generator, which allows to easily return multiple values. Use <code>yield event</code> for valid Events and <code>return</code> in case of a void result (not parsable line, invalid data etc.).</p> <h3 id=tests>Tests</h3> <p>In order to do automated tests on the bot, it is necessary to write tests including sample data. Have a look at some existing tests:</p> <ul> <li>The DummyParserBot in <code>intelmq/tests/lib/test_parser_bot.py</code>. This test has the example data (report and event) inside the file, defined as dictionary.</li> <li>The parser for malwaregroup at <code>intelmq/tests/bots/parsers/malwaregroup/test_parser_*.py</code>. The latter loads a sample HTML file from the same directory, which is the raw report.</li> <li>The test for ASNLookupExpertBot has two event tests, one is an expected fail (IPv6).</li> </ul> <p>Ideally an example contains not only the ideal case which should succeed, but also a case where should fail instead. (TODO: Implement assertEventNotEqual or assertEventNotcontainsSubset or similar) Most existing bots are only tested with one message. For newly written test it is appreciable to have tests including more then one message, e.g. a parser fed with an report consisting of multiple events.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kn>import</span> <span class=nn>unittest</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=kn>import</span> <span class=nn>intelmq.lib.test</span> <span class=k>as</span> <span class=nn>test</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=kn>from</span> <span class=nn>intelmq.bots.parsers.exampleparser.parser</span> <span class=kn>import</span> <span class=n>ExampleParserBot</span>  <span class=c1># adjust bot class name and module</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=k>class</span> <span class=nc>TestExampleParserBot</span><span class=p>(</span><span class=n>test</span><span class=o>.</span><span class=n>BotTestCase</span><span class=p>,</span> <span class=n>unittest</span><span class=o>.</span><span class=n>TestCase</span><span class=p>):</span>  <span class=c1># adjust test class name</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;A TestCase for ExampleParserBot.&quot;&quot;&quot;</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>    <span class=nd>@classmethod</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>    <span class=k>def</span> <span class=nf>set_bot</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>        <span class=bp>cls</span><span class=o>.</span><span class=n>bot_reference</span> <span class=o>=</span> <span class=n>ExampleParserBot</span>  <span class=c1># adjust bot class name</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>        <span class=bp>cls</span><span class=o>.</span><span class=n>default_input_message</span> <span class=o>=</span> <span class=n>EXAMPLE_EVENT</span>  <span class=c1># adjust source of the example event (dict), by default an empty event or report (depending on bot type)</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>    <span class=c1># This is an example how to test the log output</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>    <span class=k>def</span> <span class=nf>test_log_test_line</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test if bot does log example message.&quot;&quot;&quot;</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>        <span class=bp>self</span><span class=o>.</span><span class=n>run_bot</span><span class=p>()</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertRegexpMatches</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>loglines_buffer</span><span class=p>,</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>                                 <span class=s2>&quot;INFO - Lorem ipsum dolor sit amet&quot;</span><span class=p>)</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>    <span class=k>def</span> <span class=nf>test_event</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test if correct Event has been produced.&quot;&quot;&quot;</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a>        <span class=bp>self</span><span class=o>.</span><span class=n>run_bot</span><span class=p>()</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertMessageEqual</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>EXAMPLE_REPORT</span><span class=p>)</span>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>  <span class=c1># pragma: no cover</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>    <span class=n>unittest</span><span class=o>.</span><span class=n>main</span><span class=p>()</span>
</code></pre></div> <p>When calling the file directly, only the tests in this file for the bot will be expected. Some default tests are always executed (via the <code>test.BotTestCase</code> class), such as pipeline and message checks, logging, bot naming or empty message handling.</p> <p>See the <code>testing</code> section about how to run the tests.</p> <h3 id=cache>Cache</h3> <p>Bots can use a Redis database as cache instance. Use the <code>intelmq.lib.utils.Cache</code> class to set this up and/or look at existing bots, like the <code>cymru_whois</code> expert how the cache can be used. Bots must set a TTL for all keys that are cached to avoid caches growing endless over time. Bots must use the Redis databases &gt;= 10, but not those already used by other bots. Look at <code>find intelmq -type f -name '*.py' -exec grep -r 'redis_cache_db' {} +</code> to see which databases are already used.</p> <p>The databases &lt; 10 are reserved for the IntelMQ core:</p> <ul> <li>2: pipeline</li> <li>3: statistics</li> <li>4: tests</li> </ul> <h3 id=documentation>Documentation</h3> <p>Please document your added/modified code.</p> <p>For doc strings, we are using the <a href=http://www.sphinx-doc.org/en/stable/ext/napoleon.html#type-annotations>sphinx-napoleon-google-type-annotation</a>.</p> <p>Additionally, Python's type hints/annotations are used, see PEP484.</p> <h2 id=testing-pre-releases>Testing Pre-releases</h2> <h3 id=installation>Installation</h3> <p>The installation procedures need to be adapted only a little bit.</p> <p>For native packages, you can find the unstable packages of the next version here: <a href="https://software.opensuse.org/download.html?project=home%3Asebix%3Aintelmq%3Aunstable&package=intelmq">Installation Unstable Native Packages</a> . The unstable only has a limited set of packages, so enabling the stable repository can be activated in parallel. For CentOS 8 unstable, the stable repository is required.</p> <p>For the installation with pip, use the <code>--pre</code> parameter as shown here following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>pip3<span class=w> </span>install<span class=w> </span>--pre<span class=w> </span>intelmq
</code></pre></div> <p>All other steps are not different. Please report any issues you find in our <a href=https://github.com/certtools/intelmq/issues/new>Issue Tracker</a>.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/certtools/intelmq target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://pypi.org/project/intelmq/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> </a> <a href=https://hub.docker.com/u/certat target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.copy", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.af256bd8.min.js></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>